<#include "/cms/commons/header.html">
<script type="text/javascript" charset="utf-8" src="plug-in/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="plug-in/ueditor/ueditor.all.js"></script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="plug-in/ueditor/lang/zh-cn/zh-cn.js"></script>

<script type="text/javascript" src="media/js/bootstrap-datetimepicker.js"></script>
<!-- ztree -->
<link rel="stylesheet" href="tree/css/demo.css" type="text/css">
<link rel="stylesheet" href="tree/css/zTreeStyle/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="tree/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="tree/js/jquery.ztree.excheck-3.5.js"></script>
<!-- 标尺 -->
<link rel="stylesheet" href="statics/themes/default/js/biaochi/css/biaochi.css" type="text/css" />
<!-- 来源名称 -->
<!--<link rel="stylesheet" type="text/css" href="media/css/select2_metro.css" />-->
<!--select2-->
<link rel="stylesheet"  href="media/css/select2.min.css" type="text/css"/>

<script type="text/javascript" src="media/js/select2/select2.js"></script>


<style>
.images{width:100px;height:100px;margin:10px 10px 10px 10px;float:left;border:2px solid #eee}
.img{width:100px;height:100px;}
.del{ width:16px; height:16px;  border:0; background:url(media/image/del.gif) no-repeat left top;}
.imagesurl{min-height:130px;width:650px;border:1px solid #eee;margin-bottom:10px}
</style>
<!-- 功能js -->
<script type="text/javascript" src="js/content.js"></script>
<div class="row-fluid">
	<div class="span12">
		<div class="portlet box blue" style="margin-bottom: 0px;">
			<div class="portlet-title">
				<div class="caption"><i class="icon-reorder"></i>
				&nbsp;${contentCat.name}&nbsp;>&nbsp;文章</div>
				<div class="tools">

				</div>
			</div>
			<div class="portlet-body form">
				<!-- BEGIN FORM-->
				<form id="form_sample_2" class="form-horizontal">
					<input type="hidden" id="id" name="id" value="${page.id?if_exists}"/>
					<input type="hidden" id="contentCatId" name="contentCatId" value="${contentCat.id}"/>
					<input type="hidden" id="modelsId" name="modelsId" value="${modelsId}"/>
					<input type="hidden" id="modelId" name="modelId" value="${contentCat.jsonid}"/>
					<input type="hidden" id="contentid" name="contentid" value="${contents.id?if_exists}"/>
					<input type="hidden" id="contentsId" name="contentsId" value="${contents.id?if_exists}"/>
					<input type="hidden" id="temporary" name="temporary" value="${temporary}"/>
					<input type="hidden" id="flag" name="flag" value="${flag}"/>

					<div class="alert alert-error hide">
						<button class="close" data-dismiss="alert"></button>
						有未填写项或错误项. 请检查后再提交.
					</div>
					<div class="alert alert-success hide">
						<button class="close" data-dismiss="alert"></button>
						表单验证成功!
					</div>
					<div class="clearfix">
						<div class="control-group pull-left span4">
							<label class="control-label">当前栏目：</label>
							<div class="controls">
								<span class="help-inline" style="font-size:14px;font-weight:bold;">
								${contentCat.name}
								</span>
							</div>
						</div>
						<span id="relevanceCat">
							<div class="control-group pull-left span5">
								<label class="control-label">同时引用到：</label>
								<div class="controls">
									<input type="hidden" id="mobileId">
									<input type="hidden" id="flag" value="${flag?if_exists}">
									<input type="text" id="souContent" name="souContent" class="form-control span10" onclick="showMenu1()" style="text-align:center;" readonly value="-----选择栏目-----">
								</div>
							</div>
							<div id="menuContent1" class="menuContent1" style="display:none; position: absolute;z-index:100">
								<ul id="treeDemo1" class="ztree" style="margin-top:0px; width:258px; height: 200px">
								</ul>

							</div>
							<div class="right" style="display:none">
								<input type="text" id="funVal0" name="funVal0"/>
								<ul class="info">
									<li class="title"><h2>1、setting 配置信息说明</h2>
										<ul class="list">
											<li class="highlight_red">使用 checkbox，必须设置 setting.check 中的各个属性，详细请参见 API 文档中的相关内容</li>
											<li><p>父子关联关系：<br/>
													被勾选时：<input type="checkbox" id="py" class="checkbox first" checked /><span>关联父</span>
													<input type="checkbox" id="sy" class="checkbox first" checked /><span>关联子</span><br/>
													取消勾选时：<input type="checkbox" id="pn" class="checkbox first" checked /><span>关联父</span>
													<input type="checkbox" id="sn" class="checkbox first" checked /><span>关联子</span><br/>
													<ul id="code1" class="log" style="height:20px;"></ul></p>
											</li>
										</ul>
									</li>
								</ul>
							</div>
						</span>
					</div>
					<div class="control-group">
						<label class="control-label"><span class="required">*</span>标题：</label>
						<div class="controls">
							<input type="text" id="title" name="title" class="span9 form-control" data-rule-required="true" style="BACKGROUND: url(plug-in/img/ressources/ruler.gif) ;BACKGROUND-REPEAT: repeat-x ; color:${contents.color?if_exists}"   value="${contents.title?if_exists}"/>
							<div id="input1" title="选择颜色" style="position: relative;display:inline-block;vertical-align: bottom;cursor: pointer;width:30px;height:30px;background-color: <#if page.color?exists && page.color!=''>${page.color}<#else>rgb(0,0,0)</#if>">
								<div id="colorpane" style="position:relative;z-index:999;display:none;"></div>
							</div>
							<input type="text" id="color" name="color" class="span6 m-wrap" style="display:none" value="${page.color?if_exists}"/>
							<#--
							<br/>
							<p>
							<input type="checkbox" <#if contents.lockContent=="true">checked</#if> onclick="$('#lockContent').val(this.checked)" />
							<span style="color:red;font-weight:bold;">当前稿件是否锁定,锁定后复制或引用到其它栏目，一直保持与锁定稿件一致</span>
							<input type="hidden" id="lockContent" name="lockContent" value="${contents.lockContent!'false'}" >
							<p>
							-->
	                        <input type="hidden" id="lockContent" name="lockContent"
	                               value="${contents.lockContent!'false'}">
						</div>
					</div>
					<div class="clearfix">
						<div class="control-group pull-left span5"  id="subdiv">
							<label class="control-label">短标题：</label>
							<div class="controls">
								<input type="text" id="subtitle" name="subtitle" class="form-control span11" value="${contents.subtitle?if_exists}"/>
								<span class="help-inline"></span>
							</div>
						</div>
						<div class="control-group pull-left span5">
							<label class="control-label">引题：</label>
							<div class="controls">
								<input type="text" id="citetitle" name="citetitle" class="form-control span11" value="${contents.citetitle?if_exists}"/>
								<span class="help-inline"></span>
							</div>
						</div>
					</div>
					<input type="hidden" id="classify" name="classify" class="span10 form-control" value="${contents.classify?if_exists}"/>
					<div class="clearfix">
						<!-- 来源 DEMO-->
						<div class="control-group pull-left span5"">
							<label class="control-label">来源：</label>
							<div class="controls">
								<input type="text"  id="sourceid" class="span11 form-control" name="sourceid" value="${contents.sourceid!'${site.shortName}'}">
								<!-- <input type="text"  id="select2_sample5" class="select2 span11 form-control" name="sourceid" value="${contents.sourceid!'本站原创'}"> -->
							</div>
						</div>
						<div class="control-group pull-left span5">
							<label class="control-label">作者：</label>
							<div class="controls">
								<input type="text"  id="author" name="author" class="form-control tooltips span11" value="<#if contents.author?exists>${contents.author!''}<#elseif memberinfo.realName?exists>${memberinfo.realName!''}<#else>${memberinfo.userName!''}</#if>" data-original-title="请输入作者" data-trigger="hover"/>
							</div>
						</div>
						<!-- 来源DEMO seadData -->
					</div>
					<div class="clearfix">
						<div class="control-group pull-left span5">
							<label class="control-label">编辑人：</label>
							<div class="controls">
								<input type="text" id="editor" name="editor" class="form-control tooltips span11" value="<#if contents.editor?exists>${contents.editor!''}<#elseif memberinfo.realName?exists>${memberinfo.realName!''}<#else>${memberinfo.userName!''}</#if>" data-original-title="请输入责任编辑" data-trigger="hover"/>
							</div>
						</div>
					</div>
			       <div class="control-group">
					   <label class="control-label">标签：</label>
					   <div class="controls">
					   		<input type="hidden" id="tags" name="tags" value="${contents.tags?if_exists}">
					   　	<select  class="form-control span11" id="select2Tags" multiple="multiple" onchange="changeTages()">
							   <#if contentTagList?exists && contentTagList?size gt 0>
							  	 <#list contentTagList as tags>
							   		<option value="${tags.tagName}">${tags.tagName}</option>
								 </#list>
							   </#if>

					   		</select>
					   </div>
					</div>

					<div class="control-group">
					<label class="control-label">编辑word文档：</label>
						<div class="controls">
							<div id="uploadWord" style="float:left;padding:0px !important;" class="btn blue">
								上传word文档 <i class="icon-plus"></i>
							</div>
							<span style="float:left;margin-left:20px;color:#4D90FE;padding-top: 8px;text-decoration:underline;">(可以将word文档上传至文本编辑器进行编辑;但样式较复杂的word文档,在文本编辑器中可能会失真)</span>
						</div>
					</div>
					<div class="control-group" style="display:none">
						<label class="control-label">发布人：</label>
						<div class="controls">
							<input type="text" id="publishedby" name="publishedby" class="span6 form-control" value="<#if contents.publishedby=="">${markpeople}</#if><#if contents.publishedby!="">${contents.publishedby?if_exists}</#if>"/>
							<span class="help-inline">填写发布人</span>
						</div>
					</div>
					<div class="control-group">
						<div class="controls">
							<div class="span10">
							<script id="ueditor" name="content" type="text/plain" style="height:500px;width:100%;max-width:680px;">${page.content!''}</script>
							<script type="text/javascript">
							    //实例化编辑器
							    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
							    var ueditor = UE.getEditor('ueditor');
							</script>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">摘要：</label>
						<div class="controls">
							<textarea id="digest" name="digest" class="span8 form-control tooltips" rows="3" data-original-title="请输入摘要" data-trigger="hover" onKeyDown="gbcount(this.form.digest,this.form.total,this.form.used);" onKeyUp="gbcount(this.form.digest,this.form.total,this.form.used);" onmousedown="gbcount(this.form.digest,this.form.total,this.form.used);">${contents.digest?if_exists}</textarea>
							<input disabled style="border:none;width:25px;margin-top:60px;color:#009933;font-weight:bold;background-color: #fff !important;" name="used" value="0" id="used">
							<input type="hidden" disabled maxLength="4" name="total" size="3" value="200" class="inputtext">
							<a id="extract" class="btn blue mini" title="提取内容中前200字符" style="margin-top: 43px;text-decoration: none" onclick="extractContent()">
								提取摘要 <i class="icon-plus"></i>
							</a>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">列表缩略图：</label>
						<div class="controls">
							<div>
								<input type="hidden" id="backpath" name="thumb" class="span8 form-control" value="${contents.thumb?if_exists}"/>
								<div   class="imagesurl">
                               		<#if contents.thumb?if_exists>
                                		<#list contents.thumb?split(",") as thumbType>
                                		<div id="${thumbType_index?if_exists+1}" class='images'><img src="${thumbType}" class='img'/>
                                		   <input type='button' class='del' onclick="delimg('${thumbType_index?if_exists+1}','backpath')">
                                		</div>
                                		</#list>
                                	</#if>
                           		</div>
								<a class="btn blue" href="javascript:void(0);" onclick="toEditModel('attachPictureController.do?tableDialog&ischecks=true&requestCode=backpath')">
									图片库 <i class="icon-search"></i>
								</a>
								<div id="uploadThumb" class="btn green" style="padding:0px !important;">选取<i class="icon-upload-alt"></i></div>
							</div>
						</div>
					</div>

					<div class="right" style="display:none">
						<input type="button" value="获取选中的值" id="button"/>
						<input type="text" id="attrVal" name="attrVal"/>
						<ul class="info">
							<li class="title"><h2>1、setting 配置信息说明</h2>
								<ul class="list">
									<li class="highlight_red">使用 checkbox，必须设置 setting.check 中的各个属性，详细请参见 API 文档中的相关内容</li>
									<li><p>父子关联关系：<br/>
											被勾选时：<input type="checkbox" id="py" class="checkbox first" checked /><span>关联父</span>
											<input type="checkbox" id="sy" class="checkbox first" checked /><span>关联子</span><br/>
											取消勾选时：<input type="checkbox" id="pn" class="checkbox first" checked /><span>关联父</span>
											<input type="checkbox" id="sn" class="checkbox first" checked /><span>关联子</span><br/>
											<ul id="code" class="log" style="height:20px;"></ul></p>
									</li>
								</ul>
							</li>
						</ul>
					</div>

					<div class="clearfix">
						<div class="control-group pull-left span4">
							<label class="control-label">维度：</label>
							<div class="controls" style="position: relative;">
								<input id="attribute" name="attribute" type="text" class="m-wrap span11" readonly value="${contents.attribute?if_exists}" onclick="showMenu();" />
								<span class="help-inline"></span>
								<div id="menuContent" class="menuContent" style="display:none;z-index:999999; position: absolute;">
									<ul id="treeDemo" class="ztree" style="margin-top:0; width:250px; height: 140px">
									</ul>

								</div>
							</div>
						</div>
						<div class="control-group pull-left span4">
							<label class="control-label span3">状态：</label>
							<div class="controls span6">
								<#if contents.constants=="">
									<label class="radio">
												<input type="radio"  id="constants2" name="constants" value="0" checked>
										发布
									</label>
									<label class="radio">
												<input type="radio" id="constants3" name="constants" value="10">
										草稿
									</label>
								</#if>
								<#if contents.constants!="">
									<#if contents.constants=="10">
										<span class="help-inline" style="margin-top:10px">草稿</span>
									</#if>
									<#if contents.constants=="20">
										<span class="help-inline" style="margin-top:10px">待审</span>
									</#if>
									<#if contents.constants=="30">
										<span class="help-inline" style="margin-top:10px">退稿</span>
									</#if>
									<#if contents.constants=="40">
										<span class="help-inline" style="margin-top:10px">待发</span>
									</#if>
									<#if contents.constants=="50">
										<span class="help-inline" style="margin-top:10px">已发</span>
									</#if>
									<#if contents.constants=="60">
										<span class="help-inline" style="margin-top:10px">已撤</span>
									</#if>
									<#if contents.constants=="70">
										<span class="help-inline" style="margin-top:10px">回收站</span>
									</#if>
								</#if>
							</div>
						</div>
						<div class="control-group pull-left span3">
							<label class="control-label span3">评论：</label>
							<div class="controls span4">
								<label class="checkbox">
									<input type="checkbox" <#if contents.allowcomment=="true"||contents.allowcomment=="">checked</#if> onclick="$('#allowcomment').val(this.checked)" /> 允许
								</label>
								<input type="hidden" id="allowcomment" name="allowcomment" value="true" >
							</div>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">权重：</label>
						<div class="controls" style="position: relative;">
							<input type="text" id="weight" name="weight" class="span1 m-wrap tooltips" value="${contents.weight!'0'}" readonly data-original-title="权重将决定在哪里显示和排序" data-trigger="hover"/>

							<div class="biaoche" id="biaochex" style="margin:5px 0px 0px 30px;position: absolute;">
								<div class="ui-draggable" id="biaochex_left"
									style="left: 84px;"></div>
								<div class="biaoche-h">
									<div class="hov"
										style="position: absolute; left: 367px; top: 1px; background: none repeat scroll 0% 0% rgb(255, 102, 0); width: 7px; height: 6px; cursor: pointer; margin-top: 2px;"
										msg="60：上首页图片速读、视频新闻、活动">
										<div class="bubble"
											style="display: none; top: 36px; right: -6px;">
											<div class="corner tl"></div>
											<div class="corner tr"></div>
											<div class="corner bl"></div>
											<div class="corner br"></div>
											<div class="top"></div>
											<div class="cnt">60：上首页频道滚动列表</div>
											<div class="bot"></div>
											<div class="point NE"></div>
										</div>
									</div>
								</div>
								<div class="biaoche-h">
									<div class="hov"
										style="position: absolute; left: 487px; top: 1px; background: none repeat scroll 0% 0% rgb(255, 102, 0); width: 7px; height: 6px; cursor: pointer; margin-top: 2px;"
										msg="80：上首页图片速读、视频新闻、活动">
										<div class="bubble"
											style="display: none; top: 36px; right: -7px;">
											<div class="corner tl"></div>
											<div class="corner tr"></div>
											<div class="corner bl"></div>
											<div class="corner br"></div>
											<div class="top"></div>
											<div class="cnt">80：专栏首页推荐文章</div>
											<div class="bot"></div>
											<div class="point NE"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">附件：</label>
						<div class="controls">
							<div  class="span8 accessoryDiv">
							</div>
							<a id="addacc" style="margin-left:15px;text-decoration: none" class="btn blue" onclick="toAdd('contentAccessoryController.do?add&contentId=${contents?if_exists.id}&temporary=${temporary}')">
								增加附件 <i class="icon-plus"></i>
							</a>
						</div>
					</div>
					<div class="clearfix">
						<div class="control-group pull-left span5">
							<label class="control-label">上线：</label>
							<div class="controls">
								<input type="text" id="d4311" value="${contents.published?if_exists}" class="Wdate" onFocus="WdatePicker({maxDate:'#F{$dp.$D(\'d4312\')||\'{%y-%M-%d %H:%m:%s}\'}',dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="published">
							</div>
						</div>
						<div class="control-group pull-left span4">
							<label class="span10">下线：<input type="text" id="d4312" value="${contents.noted?if_exists}" class="Wdate" onFocus="WdatePicker({minDate:'#F{$dp.$D(\'d4311\')}',dateFmt:'yyyy-MM-dd HH:mm:ss'})" name="noted"></label>
						</div>
						<div class="control-group pull-left span3">
							<label class="span10">
							标记：
							<select id="contentMark" name="contentMark" class="span6">
								<option value="0">请选择</option>
								<#list typeList as type>
									<option value="${type.id}" <#if (contents.contentMark==type.id)>selected</#if>>${type.typename}</option>
								</#list>
							</select>
							</label>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">相关：</label>
						<div class="controls">
							<input type="text" id="correlation" name="correlation" readonly="readonly" class="span7 m-wrap" value="${contents.tags?if_exists}"/>
							<a id="sample_editable_1_new" class="btn blue" onclick="toEdit('','${temporary}','<#if contents.id==''>-1</#if><#if contents.id!=''>${contents.id?if_exists}</#if>')" style="text-decoration: none">
								搜索 <i class="icon-search"></i>
							</a>
							<a id="sample_editable_2_new" class="btn green" onclick="toAdd('relateContentController.do?addPageModel&temporary=${temporary}&contentId=${contents.id?if_exists}')" style="text-decoration: none">
								手工添加 <i class="icon-plus"></i>
							</a>
						</div>
						<!-- 显示相关弹出框返回值 -->
						<div id="correlationDiv" class="controls">
						</div>
						<!-- 显示相关弹出框返回值 -->
					</div>
					<#--拓展字段-->
					<#include "/cms/commons/contentExtField.html">
				</form>
			</div>
			<div class="modal-footer">
	            <input  type="button" onclick="checkForm('contentsController.do?save','form_sample_2')" class="btn btn-primary" value="提交">
	            <input type="button" class="btn" value="关闭" onclick="window.opener=null;window.close();">
	        </div>
		</div>
	</div>
</div>
<div id="editModel" class="modal hide fade" tabindex="-1" data-backdrop="static" data-focus-on="input:first" data-width="800"></div>
<div id="contentModel" class="modal hide fade" tabindex="-1" data-backdrop="static" data-focus-on="input:first" data-width="800"></div>
<div id="showModel" class="modal hide fade" tabindex="-1" data-backdrop="static" data-focus-on="input:first" data-width="600"></div>
<script>
 $(document).ready(function(){
   imgnumber("backpath");
  });
	//图片上传
	    var uploaderThumb = WebUploader.create({
		// 选完文件后，是否自动上传。
	    auto: true,

	    // swf文件路径
	    swf: 'plug-in/ueditor/third-party/webuploader/Uploader.swf',

	    // 文件接收服务端。
	    server: 'controller.jsp?action=uploadimage',

	    // 选择文件的按钮。可选。
	    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	    pick: '#uploadThumb',

	    // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
	    resize: false,

	    // 只允许选择图片文件。
	    accept: {
	        title: 'Images',
	        extensions: 'gif,jpg,jpeg,bmp,png',
	        mimeTypes: 'image/gif,image/jpg,image/jpeg,image/bmp,image/png'
	    }

	});


	//当有文件添加进来的时候
	uploaderThumb.on( 'uploadSuccess', function( file,Object ) {
	var inputName="backpath";
			if($("#"+inputName).val()){
				$("#"+inputName).val($("#"+inputName).val()+","+Object.url);
			}else{
				$("#"+inputName).val(Object.url);
			}
		imgnumber(inputName);
		showallimg(inputName);
	  });


	/****************************上传word文档**************************************************/

	    var uploaderWord = WebUploader.create({
		// 选完文件后，是否自动上传。
	    auto: true,

	    // swf文件路径
	    swf: 'plug-in/ueditor/third-party/webuploader/Uploader.swf',

	    // 文件接收服务端。
	    server: 'controller.jsp?action=uploadfile',

	    // 选择文件的按钮。可选。
	    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	    pick: '#uploadWord',

	    // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
	    resize: false,


	   //只允许上传word文档
	    accept: {
            title: 'Applications',
            extensions: 'doc,docx',
            mimeTypes: 'application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        } ,
    	duplicate: true
	});



	//当有文件添加进来的时候
	uploaderWord.on( 'uploadSuccess', function( file,Object) {
	var pathUrl=Object.url;
	var fileType=Object.type;
	$.ajax({
				type:'post',
				url:"contentsController.do?wordToHtml&pathUrl="+pathUrl+"&fileType="+fileType,
				success:function(data){
			    /*  UE.getEditor('ueditor').setContent(data.replace(/\\/g,""), true);
				var  source=UE.getEditor('ueditor').queryCommandState( 'source' );
				/* if(source==0){
				 UE.getEditor('ueditor').execCommand( 'source');
				/*  UE.getEditor('ueditor').execCommand('inserthtml',"<div>这是什么东西</div>");
				UE.getEditor('ueditor').setContent(data.replace(/\\/g,"").repalce(/<br\/>/g), true);
				 alert(data);
				} */
				var first=data.replace(/\\/g,"");
				var last=first.replace(/<br+\/>/g , "");
				UE.getEditor('ueditor').setContent(last,true);
					},
				error:function(){
					lmAlert("提交通讯失败!");
				}
	  });
	 });
  /****************************上传word文档**************************************************/


	//顺序值
	var ss = new Array();
	//表单校验
	function checkForm(toUrl,formName){
		var urlStr = toUrl+"&divValue="+ss;
		if($('#form_sample_2').valid()){
			//formSubmitModelCKeditor('articleController.do?save&divValue='+ss, 'form_sample_2');
			var el = $(".page-header-fixed");
			App.blockUI(el);
			$.ajax({
				type:'post',
				url:urlStr,
				data:$('#' + formName).serialize(),
				success:function(msg){
					var obj = JSON.parse(eval(msg));
					if(obj.isSuccess){
						window.opener.changePage(obj.toUrl);
						if(''=='${contents.constants?if_exists}'){
							var radio=document.getElementById("constants2");
							if(radio.checked){
								toEditModel("contentsController.do?pushView&contentsId="+obj.contentsid+"&contentCatId=${contentCat.id}&classify=${classify}&flag=${flag}");
							}
							else{
								lmAlert(obj.msg);
							}
						}else{
							if('50'=='${contents.constants}'||'40'=='${contents.constants}'){
								toEditModel("contentsController.do?pushView&contentsId="+obj.contentsid+"&contentCatId=${contentCat.id}&classify=${classify}&flag=${flag}");
							}else{
								lmAlert(obj.msg);
							}
						}
					}else{
						lmAlert("提交处理失败!");
					}
				},
				error:function(){
					lmAlert("提交通讯失败!");
				},
				complete:function (){
					App.unblockUI(el);
				}
			});
	  	}
	}

	jQuery(document).ready(function() {
		$("#backpath").livetip();
		App.init();
		FormComponents.init();
		$("#form_sample_2").myValidate();
		//判断是否显示关联栏目
		var contentCat = $("#flag").val();
		if(contentCat=="edit"){
			$("#relevanceCat").hide();
		}
		//加载相关内容
		$.ajax({
			type:'post',
			url:'contentsController.do?showEditDiv&contentId=${contents?if_exists.id}&temporary=${temporary}',
			data:'data=0',
			dataType:'text',
			success:function(msg){
				$('#').empty();
				$('#correlationDiv').append(msg);
			},
			error:function(){
				lmAlert("load page error, page url is " + urlStr);
			}
		});
		var contentId = "${contents?if_exists.id}";
		var temporary = "${temporary}";
		//加载附件div
		$.ajax({
			type:'post',
			url:'articleController.do?loadAccessory',
			data:'contentId='+contentId+'&temporary='+temporary,
			dataType:'text',
			success:function(msg){
				$('.accessoryDiv').empty();
				$('.accessoryDiv').append(msg);
			},
			error:function(){
				lmAlert("load page error, page url is " + urlStr);
			}
		});
	});


	$(function(){
		//页面加载统计字数
		var length = $('#digest').val().length;
		if(length!=""){
			length = $('#used').attr('value',length);
		}else{
			$('#used').attr('value',0);
		}
		<#if modelItemList?exists>
			<#list modelItemList as modelItem>
				<#if modelItem.dataType=="2">
					//给class为only的文本框绑定keypress(键盘按下)事件
					$("#${modelItem_index}").bind("keypress",filterInt);
					//给class为onlyInt的文本框绑定blur(失焦)事件
					$("#${modelItem_index}").bind("blur",checkInt);
				</#if>
			</#list>
		</#if>
		<#if modelItemList?exists>
			<#list modelItemList as modelItem>
				<#if modelItem.data_type=="2">
					//给class为only的文本框绑定keypress(键盘按下)事件
					$("#${modelItem_index}").bind("keypress",filterInt);
					//给class为onlyInt的文本框绑定blur(失焦)事件
					$("#${modelItem_index}").bind("blur",checkInt);
				</#if>
			</#list>
		</#if>
		//判断是否有副题
		<#if contents.subtitle!="">
			document.getElementById('subdiv').style.display = 'block';
		</#if>
		//标尺
		var options={};
		options.axis = "x";
		var s="left";
		$("#biaoche"+options.axis+"_left").css(s,$("#weight").val()*6+6+"px");
		$("#biaoche"+options.axis+"_left").draggable({//移动游标 采用JQuery中的UI插件
			containment: '#biaoche'+options.axis,
			axis: options.axis,
			grid:[2,2],
			start: function() {
			},
			drag: function() {
					divT=$("#biaoche"+options.axis+"_left").css(s);
					divT=parseInt(((parseInt(divT)-4)/6));
					if(divT>100) divT=100;
					else if(divT<0) divT=0;
					$("#weight").val(divT);
			}
		});
		return false;
	});
	$.each($('.biaoche-h'),function(){
		var _this = $(this),
			hov = $('.hov', _this);
		hov.hover(function(){
				$(this).children('.bubble').css('display','block');
			},
			function(){
				$(this).children('.bubble').css('display','none');
			}
		);
	});
	 //加载栏目
	var setting1 = {
		check: {
			enable: true
		},
		view: {
			dblClickExpand: false
		},
		data: {
			simpleData: {
				enable: true
			}
		},
		callback: {
			beforeClick: beforeClick1,
			onCheck: onCheck1
		}
	};
	var zNodes1 = new Array();
	$.ajax({
		type:'post',
		async:false,
		url:'contentsMobileController.do?loadmobile',
		data:'data=0',
		success:function(data){
			 zNodes1 = data;
		}
	})
	var json1 = JSON.parse(zNodes1);
	$(document).ready(function(){

		$.fn.zTree.init($("#treeDemo1"), setting1,json1);
		setCheck1();
		$("#py").bind("change", setCheck);
		$("#sy").bind("change", setCheck);
		$("#pn").bind("change", setCheck);
		$("#sn").bind("change", setCheck);
		$('#treeDemo1').click(function(){
			var zTree = $.fn.zTree.getZTreeObj("treeDemo1");
			var checked=zTree.getCheckedNodes(true);//所有已经选中的对象
			var checkCount = checked.length;
			var v="";
			for(var i=0;i<checkCount;i++){
				v+=checked[i].id+",";//获取的是值
				//v+=checked[i].name+",";//获取的是名称
			}
			$('#funVal0').attr("value",v);
		});

	});

	//维度属性选择
		var setting = {
			check: {
				enable: true
			},
			view: {
				dblClickExpand: false
			},
			data: {
				simpleData: {
					enable: true
				}
			},
			callback: {
				beforeClick: beforeClick,
				onCheck: onCheck
			}
		};
		var zNodes = new Array();
		$.ajax({
			type:'post',
			async:false,
			url:'custormController.do?loadAttr&contentsId=${contents.id?if_exists}',
			data:'data=0',
			success:function(data){
				 zNodes = data;
			}
		})

		var json = JSON.parse(zNodes);
		$(document).ready(function(){
			var s = "${sourceStr}";
			var arr = s.split(',');
			var arrayObj = new Array();
			for(var i=0;i<arr.length;i++){
				arrayObj.push(arr[i]);
			}
			$("#select2_sample5").select2({
	            tags: arrayObj
	        });
			$.fn.zTree.init($("#treeDemo"), setting,json);
			setCheck();
			$("#py").bind("change", setCheck);
			$("#sy").bind("change", setCheck);
			$("#pn").bind("change", setCheck);
			$("#sn").bind("change", setCheck);
			$('#treeDemo').click(function(){
				var zTree = $.fn.zTree.getZTreeObj("treeDemo");
				var checked=zTree.getCheckedNodes(true);//所有已经选中的对象
				var checkCount = checked.length;
				var v="";
				for(var i=0;i<checkCount;i++){
					v+=checked[i].id+",";//获取的是值
					//v+=checked[i].name+",";//获取的是名称
				}
				$('#attrVal').attr("value",v);
			});
			initcolor();
			//获取相关内容div  li的顺序(必须在上面异步加载完div之后再调用，否则无效)
			$( "#sortable1" ).sortable({
				connectWith: ".connectedSortable",
				 update: function(event, ui) {
					var size = ui.item.context.parentElement.children;
					for(var i=0;i<size.length;i++){
						ss[i] = i+"_"+size[i].id;
					}
				 }
			}).disableSelection()
		});
		//提取内容To摘要
		function extractContent(){
			var content = UE.getEditor('ueditor').getContent();
			if(content!=""){
				var con = UE.getEditor('ueditor').getContentTxt();
				var contentSub = con.substring(0,200);
				$('#digest').attr('value','');
				$('#digest').attr('value',contentSub);
			}else{
				lmAlert("请填写内容之后提取！");
			}
		}

</script>
<#include "/cms/commons/footer.html">



